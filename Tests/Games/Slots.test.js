import 'core-js/stable';
import 'regenerator-runtime/runtime';

import {
  expect,
} from 'chai';

import Slots from '../../Games/Slots';

describe('Slots Verifier Tests', function() {
  const SLOTS_VERIFIER = new Slots;

  const TEST_CASES = [{
    'clientSeed': '3Kzi9PUo',
    'serverSeed':
      'e53bf7c2493baffcf1fbc7a63673f54cb5bb7a50a9b6a8e5b0ff1fefbd27ac6e',
    'serverSeedHash':
      'cd4da1cace16ad892760b38b18b72adb86dc5f007d1390d805ac452c4a9ef270',
    'range': [1, 49],
    'games': [
      [
        [12, 26, 17, 16, 16],
      ],
      [
        [24, 19, 22, 3, 39],
      ],
      [
        [0, 24, 0, 8, 37],
      ],
      [
        [11, 3, 13, 16, 18],
      ],
      [
        [23, 26, 0, 10, 7],
      ],
      [
        [1, 5, 19, 17, 16],
      ],
      [
        [23, 20, 9, 24, 27],
      ],
      [
        [24, 25, 13, 14, 2],
      ],
      [
        [26, 14, 20, 1, 38],
      ],
      [
        [1, 4, 2, 3, 29],
      ],
      [
        [23, 24, 15, 21, 1],
      ],
      [
        [16, 9, 10, 29, 11],
      ],
      [
        [28, 13, 4, 2, 38],
      ],
      [
        [23, 11, 29, 16, 1],
      ],
      [
        [16, 22, 29, 15, 3],
      ],
      [
        [20, 28, 4, 12, 27],
      ],
      [
        [10, 3, 0, 21, 7],
      ],
      [
        [3, 12, 20, 6, 27],
      ],
      [
        [27, 6, 29, 13, 17],
      ],
      [
        [10, 20, 6, 10, 27],
      ],
      [
        [25, 2, 2, 17, 24],
      ],
      [
        [2, 7, 28, 25, 15],
      ],
      [
        [25, 5, 0, 26, 19],
      ],
      [
        [22, 1, 11, 11, 36],
      ],
      [
        [4, 24, 0, 0, 33],
      ],
      [
        [2, 20, 25, 20, 35],
      ],
      [
        [19, 16, 16, 19, 31],
      ],
      [
        [13, 21, 8, 25, 13],
      ],
      [
        [5, 12, 0, 27, 26],
      ],
      [
        [9, 19, 24, 6, 15],
      ],
      [
        [5, 0, 24, 10, 12],
      ],
      [
        [27, 16, 14, 27, 2],
      ],
      [
        [3, 25, 13, 22, 5],
      ],
      [
        [13, 9, 27, 6, 22],
      ],
      [
        [12, 22, 13, 2, 6],
      ],
      [
        [1, 11, 24, 24, 39],
      ],
      [
        [7, 19, 27, 21, 22],
      ],
      [
        [15, 29, 19, 28, 36],
      ],
      [
        [18, 18, 3, 2, 34],
      ],
      [
        [27, 7, 27, 9, 36],
      ],
      [
        [8, 0, 26, 29, 27],
      ],
      [
        [28, 5, 15, 15, 18],
      ],
      [
        [6, 22, 6, 13, 26],
      ],
      [
        [3, 5, 25, 13, 33],
      ],
      [
        [23, 24, 23, 29, 17],
      ],
      [
        [23, 5, 0, 12, 29],
      ],
      [
        [12, 21, 14, 23, 3],
      ],
      [
        [16, 28, 24, 5, 21],
      ],
      [
        [10, 0, 3, 14, 11],
      ],
    ],
  }, {
    'clientSeed': 'AUCox-Us',
    'serverSeed':
      'accc520a414257281e9259fe5515f56e7f6882a7bfab78707158f95b444a8332',
    'serverSeedHash':
      '1a4fea0d96d381839c573dfb8020e46347405eafcbdc540d76d135d946515609',
    'range': [138, 138],
    'games': [
      [
        [28, 20, 18, 19, 14],
        [26, 19, 12, 2, 17],
        [27, 28, 6, 4, 14],
        [25, 25, 2, 22, 21],
        [5, 28, 6, 28, 16],
        [11, 20, 8, 12, 21],
        [29, 6, 17, 13, 36],
        [21, 1, 8, 16, 3],
        [12, 14, 2, 19, 9],
        [20, 7, 13, 16, 34],
        [10, 19, 7, 17, 37],
        [0, 24, 25, 19, 23],
        [3, 7, 5, 11, 11],
        [29, 8, 1, 18, 23],
        [26, 22, 6, 9, 11],
        [1, 21, 7, 27, 36],
      ],
    ],
  }];

  it('can verify 50 games of slots using the "Slots" provably fair algorithm.',
      function() {
        for (const {
          clientSeed,
          serverSeed,
          range,
          games,
        } of TEST_CASES) {
          for (let nonce = range[0]; nonce <= range[1]; nonce++) {
            expect(SLOTS_VERIFIER.verify({
              clientSeed,
              serverSeed,
              nonce,
            })).to.be.eql(games[nonce - range[0]]);
          }
        }
      });
});
